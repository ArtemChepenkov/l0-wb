<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Order API</title>
</head>
<body>

<!-- –ü–æ–ª—É—á–µ–Ω–∏–µ –∑–∞–∫–∞–∑–∞ -->
<h2>–ü–æ–ª—É—á–∏—Ç—å –∑–∞–∫–∞–∑</h2>
<form id="getForm">
    <input type="text" name="uid" placeholder="Order UID" required>
    <button type="submit">–ü–æ–ª—É—á–∏—Ç—å</button>
</form>
<pre id="result"></pre>

<!-- –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–∫–∞–∑–∞ -->
<h2>–°–æ–∑–¥–∞—Ç—å –∑–∞–∫–∞–∑</h2>
<form id="postForm">
    <textarea name="json" rows="20" cols="80" required>{
  "order_uid": "test123",
  "track_number": "WBILMTESTTRACK",
  "entry": "WBIL",
  "locale": "en",
  "internal_signature": "",
  "customer_id": "cust123",
  "delivery_service": "DHL",
  "shardkey": "9",
  "sm_id": 99,
  "date_created": "2021-11-26T06:22:19Z",
  "oof_shard": "1",
  "delivery": {
    "name": "Test Testov",
    "phone": "+9720000000",
    "zip": "2639809",
    "city": "Kiryat Mozkin",
    "address": "Ploshad Mira 15",
    "region": "Kraiot",
    "email": "test@gmail.com"
  },
  "payment": {
    "transaction": "b563feb7b2b84b6test",
    "currency": "USD",
    "provider": "wbpay",
    "amount": 1817
  },
  "items": [
    {
      "chrt_id": 9934930,
      "track_number": "WBILMTESTTRACK",
      "price": 453,
      "name": "Mascaras"
    }
  ]
}</textarea><br>
    <button type="submit">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
</form>
<pre id="postResult"></pre>

<script>
// –ü–æ–ª—É—á–µ–Ω–∏–µ –∑–∞–∫–∞–∑–∞
document.getElementById('getForm').onsubmit = async function(e) {
    e.preventDefault();
    const uid = this.elements.uid.value;
    try {
        const response = await fetch(`http://localhost:8081/order/${uid}`);
        const text = await response.text();
        try {
            const json = JSON.parse(text);
            document.getElementById('result').textContent = JSON.stringify(json, null, 2);
        } catch {
            document.getElementById('result').textContent = text;
        }
    } catch (err) {
        document.getElementById('result').textContent = '–û—à–∏–±–∫–∞: ' + err.message;
    }
};

// –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–∫–∞–∑–∞
document.getElementById('postForm').onsubmit = async function(e) {
    e.preventDefault();
    const json = this.elements.json.value;

    console.log('üì§ –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Ç–µ–ª–æ:', json);

    try {
        const response = await fetch('http://localhost:8081/order/upload', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: json,
            mode: 'cors'  // –µ—Å–ª–∏ HTML –æ—Ç–∫—Ä—ã—Ç –Ω–∞–ø—Ä—è–º—É—é
        });

        const text = await response.text();
        document.getElementById('postResult').textContent = '–û—Ç–≤–µ—Ç —Å–µ—Ä–≤–µ—Ä–∞: ' + text;
    } catch (err) {
        document.getElementById('postResult').textContent = '–û—à–∏–±–∫–∞: ' + err.message;
    }
};
</script>

</body>
</html>
